<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<!-- 합쳐지고 최소화된 최신 CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

<!-- 부가적인 테마 -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

<!-- 합쳐지고 최소화된 최신 자바스크립트 -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>


<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>

  <style>
    label, input { display:block; }
    input.text { margin-bottom:12px; width:95%; padding: .4em; }
    fieldset { padding:0; border:0; margin-top:25px; }
    h1 { font-size: 1.2em; margin: .6em 0; }
    div#users-contain { width: 350px; margin: 20px 0; }
    div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
    div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
    .ui-dialog .ui-state-error { padding: .3em; }
    .validateTips { border: 1px solid transparent; padding: 0.3em; }
  </style>

<script>
lstUser = [ 'UserA', 'UserB', 'UserC', 'UserD', 'UserE', 'UserF']

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

function fnLoad()
{
	var htmlUsers = ""
	var htmlUsersRadio = ""

	lstUser.forEach(function(a){
		userVal = localStorage[a]
		userSumVal = localStorage['#'+a+'_sum']

		if (userVal !=  undefined && userVal.length > 0)
		{
			htmlUsers	+= '<div id="User_B">'
			htmlUsers	+= userVal
			htmlUsers	+= '<button onClick="fnPopupEdit(' + "'#" + a + "', '" + userVal +"','Plus')" + '">[+ 더하기]</button>'
			htmlUsers	+= '<button onClick="fnPopupEdit(' + "'#" + a + "', '" + userVal + "', 'Minus')" + '">[- 뺴기]</button>'
			htmlUsers	+= '<button onClick="fnPopup(' + "'#" + a + "', '" + userVal + "'" + ')">전달하기</button>'
			htmlUsers	+= '<div id="' + a +'_sum">' + userSumVal +'</div>'
			htmlUsers	+= '</div>'

			htmlUsersRadio	+= '<label><input type="radio" name="user" value="#' + a+ '">' + userVal + '</label>'
			
			
		}
	})

	$('#Users').html(htmlUsers)

	$('#Users_Raido').html(htmlUsersRadio)

	$('#startButon').hide()
}

function init()
{
	$( "#dialog_Init").dialog({
	  title: "사용자를 등록 해주세요.",
	  modal: true,
	  buttons: {
	    "적용": function() {
		$('#dialog_Init').dialog( "close" );

		var htmlUsers = ""
		var htmlUsersRadio = ""
		lstUser.forEach(function(a){
			userVal = $('#'+a).val()
			if (userVal.length > 0)
			{

				htmlUsers	+= '<div class="d-flex justify-content-center" id="'+ a +'">'
				htmlUsers	+= userVal
				htmlUsers	+= '<button onClick="fnPopupEdit(' + "'#" + a + "', '" + userVal +"','Plus')" + '">[+ 더하기]</button>'
				htmlUsers	+= '<button onClick="fnPopupEdit(' + "'#" + a + "', '" + userVal + "', 'Minus')" + '">[- 뺴기]</button>'
				htmlUsers	+= '<button onClick="fnPopup(' + "'#" + a + "', '" + userVal + "'" + ')">전달하기</button>'
				htmlUsers	+= '<div id="' + a +'_sum">1500</div>'
				htmlUsers	+= '</div>'

				htmlUsersRadio	+= '<label><input type="radio" name="user" value="#' + a+ '">' + userVal + '</label>'
				
				localStorage[a] = userVal
			}
		})

		$('#Users').html(htmlUsers)

		$('#Users_Raido').html(htmlUsersRadio)

		localStorage.use = "Y"
		$('#startButon').hide()
	    }
	  },
  	  close: function() {
	      }
	}).dialog( "open" );
}

function fnReset()
{
	localStorage.clear();
}

function fnCalc(userID, type, valPrice, msgPopup)
{
	var msg = "더할 숫자를 입력하세요"
	if (type == "Plus")
	{
		type = 1
		msg = "더할 숫자를 입력하세요"
	} else {
		type = 2
		msg = "뺄 숫자를 입력하세요"
	}
	
	var id = userID+"_sum"
	if (valPrice == undefined){
		valPrice = prompt(msg, '');

		if (isNaN(valPrice)) {
		    alert("숫자만 입력하세요")
		    return false;
		}
	} else {
		if (msgPopup != "N") {
			if (!confirm("월급을 추가 할까요?")) {
			    return false;		
			}
		}
	}

	if (type == 1) {
		$(id).text(Number($(id).text())+Number(valPrice))	
	} else {
		$(id).text(Number($(id).text())-Number(valPrice))
	}

	localStorage[id] = $(id).text()
}

function fnPopupEdit(userID, userNM, type)
{
	var msg = "더할 숫자를 입력하세요"
	if (type == "Plus")
	{
		msg = "더할 숫자를 입력하세요"
	} else {
		msg = "뺄 숫자를 입력하세요"
	}

	var id = userID

	$('#dialog_Edit').dialog({
	  title: "[" + userNM +"] " + msg,
	  modal: true,
	  buttons: {
	    "[ 200 ]": function() {
		valPrice = 200
		fnCalc(id, type, valPrice, "N")
		$('#dialog_Edit').dialog( "close" );
	    },
	    "[ 100 ]": function() {
		valPrice = 100
		fnCalc(id, type, valPrice, "N")
		$('#dialog_Edit').dialog( "close" );
	    }, 
	    "적용": function() {
		valPrice = Number($('#User_Price_Edit').val())

		if (isNaN(valPrice)) {
			alert("숫자만 입력하세요")
		} else {
			fnCalc(id, type, valPrice, "N")
			$('#dialog_Edit').dialog( "close" );
		}

	    }
	  },
  	  close: function() {
		$('#User_Price_Edit').val("")
	      }
	}).dialog( "open" );
}

function fnPopup(userID, userNM)
{
	var selected = 0;
	$('#dialog_Change').dialog({
	  title: "[" + userNM +"] 누구에게 전달 할까요?",
	  modal: true,
	  buttons: {
	    "보내기": function() {
		price = Number($('#User_Price').val())
		if (isNaN(price)) {
			alert("숫자만 입력하세요")
		} else {
			var id = $('input[name="user"]:checked').attr('id');
			var value = $('input[name="user"]:checked').val();

			if (value == undefined) {
			} else {
				fnCalc(userID,"Minus", price, "N")
				fnCalc(value,"Plus", price, "N")

				$('#dialog_Change').dialog( "close" );
			}
		}

	    }
	  },
  	  close: function() {
		$('#User_Price').val("")
		$('input[name="user"]').each(function() {
		    $(this).prop('checked', false);
		});

	      }
	}).dialog( "open" );
}

$( document ).ready(function() {
    console.log( "ready!" );
    if (localStorage.use == "Y")
    {
	fnLoad()
    }
});

$( function() {
    var dialog, form,
 
      // From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
      emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
      name = $( "#name" ),
      email = $( "#email" ),
      password = $( "#password" ),
      allFields = $( [] ).add( name ).add( email ).add( password ),
      tips = $( ".validateTips" );
 
	$( "#dialog_Change" ).dialog({
		autoOpen: false,
		modal: true
    	});

	$( "#dialog_Edit" ).dialog({
		autoOpen: false,
		modal: true
    	});

	$( "#dialog_Init" ).dialog({
		autoOpen: false,
		modal: true
    	});

	var htmlText = ""
	lstUser.forEach(function(a){
		htmlText += '<input type="text" id="'+a+'" value="" class="text ui-widget-content ui-corner-all"> '
	})
	console.log(htmlText)
	$("#dialog_Init").html(htmlText)

  } );



</script>
</head>
<body>

<div id="dialog_Init">
</div>

<div id="dialog_Edit">
    <p>금액을 입력 해주세요.</p>
    <input type="text" type="number" name="금액" id="User_Price_Edit" value="" class="text ui-widget-content ui-corner-all">
</div>

<div id="dialog_Change">
    <p>금액을 입력 해주세요.</p>
    <input type="text" type="number" name="금액" id="User_Price" value="" class="text ui-widget-content ui-corner-all">
    <p>받을 사람을 선택 해주세요</p>
    <div id=Users_Raido>
    </div>
</div>

<div id="Users">
</div>


<button class="d-flex justify-content-center" id="startButon" onClick="init()">시작</button>
<button class="d-flex justify-content-center" id="resetButon" onClick="fnReset()">초기화</button>
</body>
</html>
